<!doctype html>
<html lang="pt-BR">
  <head>
    <!-- Google Tag Manager - Deferred -->
    <script>
    // Defer GTM to not block critical rendering path
    (function() {
      var gtmScript = document.createElement('script');
      gtmScript.async = true;
      gtmScript.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-P2Q493W';
      
      if (document.readyState === 'complete') {
        setTimeout(function() { document.head.appendChild(gtmScript); }, 5000);
      } else {
        window.addEventListener('load', function() {
          setTimeout(function() { document.head.appendChild(gtmScript); }, 5000);
        });
      }
      
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({'gtm.start': new Date().getTime(), event:'gtm.js'});
    })();
    </script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.jpg" type="image/jpeg" />
    <link rel="apple-touch-icon" href="/favicon.jpg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0EA5E9" />
    
    <!-- DNS prefetch and preconnect for external domains -->
    <link rel="preconnect" href="https://form.odontoresults.com.br" crossorigin />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    
    <title>Odonto Results - Marketing Digital para Clínicas Odontológicas</title>
    <meta name="description" content="Bata recorde de faturamento recebendo pacientes certos na sua cadeira
Atraímos, respondemos, agendamos e lembramos o paciente até ele comparecer.">
    <meta name="author" content="Odonto Results" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    
    <!-- Geo tags -->
    <meta name="geo.region" content="BR" />
    <meta name="geo.placename" content="Brasil" />

    <!-- Open Graph / Facebook -->
    
    
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://odontoresults.com.br/" />
    <meta property="og:image" content="https://storage.googleapis.com/gpt-engineer-file-uploads/ahfQlROO8xTXFFL3Apwp82gLgJD3/social-images/social-1762144818430-imagemparacompartilhar.jpg">
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Odonto Results - Marketing Digital para Clínicas Odontológicas" />
    <meta property="og:locale" content="pt_BR" />
    <meta property="og:site_name" content="Odonto Results" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    
    
    <meta name="twitter:image" content="https://storage.googleapis.com/gpt-engineer-file-uploads/ahfQlROO8xTXFFL3Apwp82gLgJD3/social-images/social-1762144818430-imagemparacompartilhar.jpg">

    <meta property="og:title" content="Odonto Results - Marketing Digital para Clínicas Odontológicas">
  <meta name="twitter:title" content="Odonto Results - Marketing Digital para Clínicas Odontológicas">
  <meta property="og:description" content="Bata recorde de faturamento recebendo pacientes certos na sua cadeira
Atraímos, respondemos, agendamos e lembramos o paciente até ele comparecer.">
  <meta name="twitter:description" content="Bata recorde de faturamento recebendo pacientes certos na sua cadeira
Atraímos, respondemos, agendamos e lembramos o paciente até ele comparecer.">
</head>

  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P2Q493W"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div id="root"></div>
    
    <!-- UTM Persistence Script -->
    <script>
    (() => {
      // Quais parâmetros manter (ajuste como preferir)
      const TRACK_PARAMS = [
        "utm_source","utm_medium","utm_campaign","utm_term","utm_content",
        "utm_id","utm_source_platform","utm_campaign_id",
        "gclid","fbclid","msclkid"
      ];

      const SESSION_KEY = "persisted_utm_query";

      // Coleta UTMs da URL atual, filtrando apenas os que estão na lista
      function collectUtmFromLocation() {
        const sp = new URLSearchParams(window.location.search);
        const kept = new URLSearchParams();
        for (const key of TRACK_PARAMS) {
          if (sp.has(key)) kept.set(key, sp.get(key));
        }
        return kept.toString();
      }

      // Salva UTMs (se existirem) para reutilizar na navegação interna
      function persistUtm() {
        const q = collectUtmFromLocation();
        if (q) sessionStorage.setItem(SESSION_KEY, q);
      }

      // Recupera UTMs persistidas
      function getPersistedUtm() {
        return sessionStorage.getItem(SESSION_KEY) || "";
      }

      // Faz merge dos params de origem (UTMs) num href alvo, sem duplicar valores
      function mergeQuery(href, utmQuery) {
        if (!utmQuery) return href;
        const url = new URL(href, window.location.origin);

        const baseQs = new URLSearchParams(url.search);
        const utmQs  = new URLSearchParams(utmQuery);

        for (const [k, v] of utmQs.entries()) {
          if (!baseQs.has(k)) baseQs.set(k, v);
        }

        url.search = baseQs.toString();
        return url.toString();
      }

      // Checa se link é interno (mesma origem)
      function isInternal(url) {
        try {
          const u = new URL(url, window.location.origin);
          return u.origin === window.location.origin;
        } catch {
          return false;
        }
      }

      // Aplica UTMs em <a> e em botões com data-href
      function applyToLinksAndButtons(utmQuery) {
        // <a>
        document.querySelectorAll('a[href]').forEach(a => {
          // data-keep-utm="false" para ignorar
          if (a.dataset.keepUtm === "false") return;

          const href = a.getAttribute('href');
          // Ignora âncoras puras e JavaScript links
          if (!href || href.startsWith('#') || href.startsWith('javascript:')) return;

          const force = a.dataset.keepUtm === "force"; // aplica mesmo se externo
          if (!force && !isInternal(href)) return;

          a.href = mergeQuery(a.href, utmQuery);
        });

        // Botões que redirecionam via data-href
        document.querySelectorAll('button[data-href]').forEach(btn => {
          if (btn.dataset.keepUtm === "false") return;
          const force = btn.dataset.keepUtm === "force";
          const raw   = btn.getAttribute('data-href');
          if (!raw) return;
          if (!force && !isInternal(raw)) return;

          const merged = mergeQuery(raw, utmQuery);
          btn.setAttribute('data-href', merged);

          // Se já existir um handler próprio seu, mantenha. Aqui só adicionamos um "fallback".
          if (!btn.dataset.utmBound) {
            btn.addEventListener('click', (e) => {
              // Só redireciona se o botão não tiver tipo "submit"
              if (btn.type !== 'submit') {
                e.preventDefault();
                window.location.href = btn.getAttribute('data-href');
              }
            });
            btn.dataset.utmBound = "1";
          }
        });
      }

      // Injeta UTMs como inputs hidden em todos os <form>
      function applyToForms(utmQuery) {
        if (!utmQuery) return;
        const utmQs = new URLSearchParams(utmQuery);

        document.querySelectorAll('form').forEach(form => {
          // data-keep-utm="false" para ignorar
          if (form.dataset.keepUtm === "false") return;

          // Evita duplicar se já injetamos
          if (form.dataset.utmInjected === "1") return;

          for (const [k, v] of utmQs.entries()) {
            // Se já existe um input com esse nome, não duplica
            if (form.querySelector(`[name="${k}"]`)) continue;
            const input = document.createElement('input');
            input.type  = 'hidden';
            input.name  = k;
            input.value = v;
            form.appendChild(input);
          }
          form.dataset.utmInjected = "1";

          // Para forms GET, também mescla no action (opcional)
          if ((form.method || '').toLowerCase() === 'get' && form.action) {
            form.action = mergeQuery(form.action, utmQuery);
          }
        });
      }

      // Execução
      persistUtm();
      const utm = getPersistedUtm();

      // Se não temos UTMs nem na URL nem na sessão, não faz nada
      if (!utm) return;

      // Aplica nos elementos atuais…
      document.addEventListener('DOMContentLoaded', () => {
        applyToLinksAndButtons(utm);
        applyToForms(utm);
      });

      // …e observa alterações dinâmicas no DOM (SPAs, componentes que montam depois)
      const mo = new MutationObserver(() => {
        applyToLinksAndButtons(utm);
        applyToForms(utm);
      });
      mo.observe(document.documentElement, { childList: true, subtree: true });
    })();
    </script>
    
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
