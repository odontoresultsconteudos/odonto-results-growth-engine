<!doctype html>
<html lang="pt-BR">
  <head>
    <!-- Google Tag Manager - Optimized Loading -->
    <script>
    // Initialize dataLayer
    window.dataLayer = window.dataLayer || [];
    
    // Load GTM after page becomes interactive (balanced approach)
    (function(w,d,s,l,i){
      var gtmLoaded = false;
      
      function loadGTM() {
        if (gtmLoaded) return;
        gtmLoaded = true;
        
        // Use requestIdleCallback for optimal loading
        var actualLoad = function() {
          w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
          var f=d.getElementsByTagName(s)[0],
              j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
          j.async=true;
          j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
          f.parentNode.insertBefore(j,f);
        };
        
        if ('requestIdleCallback' in window) {
          requestIdleCallback(actualLoad, { timeout: 3000 });
        } else {
          setTimeout(actualLoad, 2000);
        }
      }
      
      // Load after first meaningful interaction OR 5 seconds
      var hasInteracted = false;
      var interactionEvents = ['mousedown', 'touchstart', 'keydown'];
      
      function handleInteraction() {
        if (!hasInteracted) {
          hasInteracted = true;
          loadGTM();
          interactionEvents.forEach(function(event) {
            window.removeEventListener(event, handleInteraction);
          });
        }
      }
      
      interactionEvents.forEach(function(event) {
        window.addEventListener(event, handleInteraction, { passive: true, once: true });
      });
      
      // Fallback: load after 2 seconds if no interaction
      setTimeout(loadGTM, 2000);
      
    })(window,document,'script','dataLayer','GTM-P2Q493W');
    </script>
    <!-- End Google Tag Manager -->

    <!-- UTM Capture Script -->
    <script>
    (function() {
      const UTM_PARAMS = ['utm_source','utm_medium','utm_campaign','utm_term','utm_content','utm_id','utm_source_platform','utm_campaign_id','gclid','fbclid','msclkid'];
      const SESSION_KEY = 'persisted_utm_query';
      
      const sp = new URLSearchParams(window.location.search);
      const utmParams = new URLSearchParams();
      
      UTM_PARAMS.forEach(function(key) {
        if (sp.has(key)) {
          utmParams.set(key, sp.get(key));
        }
      });
      
      const utmQuery = utmParams.toString();
      if (utmQuery) {
        sessionStorage.setItem(SESSION_KEY, utmQuery);
      }
    })();
    </script>
    <!-- End UTM Capture -->
    
    <meta charset="UTF-8" />
    <!-- Favicon - multiple formats for best compatibility -->
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" href="/favicon.jpg" type="image/jpeg" />
    <link rel="apple-touch-icon" href="/favicon.jpg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0EA5E9" />
    
    <!-- Critical resource hints -->
    <link rel="preconnect" href="https://form.odontoresults.com.br" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://connect.facebook.net" />
    <link rel="dns-prefetch" href="https://www.google-analytics.com" />
    
    <!-- Defer non-critical fonts -->
    <link rel="preload" href="/assets/logo-DI14klTM.svg" as="image" fetchpriority="high" />
    
    <!-- SEO tags are dynamically set by react-helmet-async in each page component -->
    <title>Odonto Results</title>
    <meta name="description" content="Marketing Digital para Clínicas Odontológicas" />
    <meta name="author" content="Odonto Results" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    
    <!-- Geo tags -->
    <meta name="geo.region" content="BR" />
    <meta name="geo.placename" content="Brasil" />
</head>

  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P2Q493W"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
